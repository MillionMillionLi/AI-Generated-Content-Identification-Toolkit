# AIç”Ÿæˆå†…å®¹è¯†åˆ«å·¥å…·åŒ…

<div align="center">
  <!-- é¡¹ç›®logoå ä½ç¬¦ - éœ€è¦logoå›¾ç‰‡ -->
  <!-- <a href="https://github.com/your-repo-link">
    <img src="images/logo.png" alt="Logo" width="80" height="80">
  </a> -->


  <h3 align="center">AIç”Ÿæˆå†…å®¹æ ‡è¯†æŠ€æœ¯å¼€å‘å¥—ä»¶</h3>

  <p align="center">
    ä¸€ç«™å¼å¼€æºæ ‡è¯†æŠ€æœ¯å¼€å‘å¥—ä»¶ï¼Œæ”¯æŒæ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘å’Œè§†é¢‘å†…å®¹çš„æ˜¾å¼æ ‡è¯†ï¼Œéšå¼æ ‡è¯†å’Œéšæ°´å°åŠŸèƒ½
    <br />
    <a href="#ä½¿ç”¨æ–¹æ³•"><strong>å¿«é€Ÿå¼€å§‹ Â»</strong></a>
    <br />
    <br />
    <a href="pictures/watermark.mp4">åœ¨çº¿æ¼”ç¤º</a>
    Â·
    <a href="https://github.com/your-repo-link/issues">æŠ¥å‘Šé—®é¢˜</a>
    Â·
    <a href="https://github.com/your-repo-link/issues">è¯·æ±‚åŠŸèƒ½</a>
  </p>

</div>

<!-- ç›®å½• -->

<details>
  <summary>ç›®å½•</summary>
  <ol>
    <li>
      <a href="#å…³äºé¡¹ç›®">å…³äºé¡¹ç›®</a>
      <ul>
        <li><a href="#æ„å»ºæŠ€æœ¯">æ„å»ºæŠ€æœ¯</a></li>
      </ul>
    </li>
    <li>
      <a href="#å¼€å§‹ä½¿ç”¨">å¼€å§‹ä½¿ç”¨</a>
      <ul>
        <li><a href="#å‰ç½®è¦æ±‚">å‰ç½®è¦æ±‚</a></li>
        <li><a href="#å®‰è£…">å®‰è£…</a></li>
      </ul>
    </li>
    <li><a href="#ä½¿ç”¨æ–¹æ³•">ä½¿ç”¨æ–¹æ³•</a></li>
    <li><a href="#ç½‘é¡µæ¼”ç¤º">ç½‘é¡µæ¼”ç¤º</a></li>
    <li><a href="#apiå‚è€ƒ">APIå‚è€ƒ</a></li>
    <li><a href="#æ€§èƒ½">æ€§èƒ½</a></li>
    <li><a href="#å‘å±•è·¯çº¿">å‘å±•è·¯çº¿</a></li>
    <li><a href="#è´¡çŒ®">è´¡çŒ®</a></li>
    <li><a href="#è®¸å¯è¯">è®¸å¯è¯</a></li>
    <li><a href="#è”ç³»">è”ç³»</a></li>
    <li><a href="#è‡´è°¢">è‡´è°¢</a></li>
  </ol>
</details>


## å…³äºé¡¹ç›®

<!-- é¡¹ç›®æˆªå›¾å ä½ç¬¦ - éœ€è¦ç½‘é¡µç•Œé¢æˆªå›¾ -->
<!-- [![äº§å“æˆªå›¾][product-screenshot]](https://example.com) -->

æœ¬é¡¹ç›®æä¾›ä¸€ç«™å¼å¼€æºæ ‡è¯†æŠ€æœ¯å¼€å‘å¥—ä»¶ã€‚æ”¯æŒæ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘å’Œè§†é¢‘å››å¤§æ¨¡æ€ï¼Œå…·å¤‡æ˜¾å¼æ ‡è¯†ã€éšå¼æ ‡è¯†å’Œéšæ°´å°åŠŸèƒ½ï¼Œå…¨é¢è¦†ç›–GB 45438-2025ã€Šç½‘ç»œå®‰å…¨æŠ€æœ¯ äººå·¥æ™ºèƒ½ç”Ÿæˆåˆæˆå†…å®¹æ ‡è¯†æ–¹æ³•ã€‹"æ ‡å‡†è§„å®šçš„æ ‡è¯†èŒƒå›´ã€‚

### ä¸ºä»€ä¹ˆé€‰æ‹©æˆ‘ä»¬ï¼Ÿ

- **å…¨é¢è¦†ç›–**ï¼šæ”¯æŒGB 45438-2025æ ‡å‡†è¦æ±‚çš„æ‰€æœ‰æ ‡è¯†æ–¹æ³•
- **å¤šæ¨¡æ€æ”¯æŒ**ï¼šç»Ÿä¸€å¤„ç†æ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘å’Œè§†é¢‘å†…å®¹
- **åŒæ¨¡å¼æ“ä½œ**ï¼šæ—¢æ”¯æŒAIå†…å®¹ç”Ÿæˆï¼Œä¹Ÿæ”¯æŒç°æœ‰æ–‡ä»¶å¤„ç†
- **ç”Ÿäº§å°±ç»ª**ï¼šé…å¤‡å®Œæ•´çš„ç½‘é¡µç•Œé¢ã€æ‰¹é‡å¤„ç†å’Œæ€§èƒ½ä¼˜åŒ–

### æ„å»ºæŠ€æœ¯

* [![Python][Python.org]][Python-url]
* [![PyTorch][PyTorch.org]][PyTorch-url]
* [![Flask][Flask.palletsprojects.com]][Flask-url]
* [![Transformers][Transformers-badge]][Transformers-url]
* [![Diffusers][Diffusers-badge]][Diffusers-url]

<p align="right">(<a href="#readme-top">è¿”å›é¡¶éƒ¨</a>)</p>

## å¼€å§‹ä½¿ç”¨

### å‰ç½®è¦æ±‚

- Python 3.8æˆ–æ›´é«˜ç‰ˆæœ¬
- æ”¯æŒCUDAçš„GPUï¼ˆæ¨èç”¨äºæœ€ä½³æ€§èƒ½ï¼‰
- FFmpegï¼ˆè§†é¢‘å¤„ç†å¿…éœ€ï¼‰

### å®‰è£…

1. å…‹éš†ä»“åº“

   ```bash
   git clone https://github.com/your-repo-link/unified_watermark_tool.git
   cd unified_watermark_tool
   ```

2. å®‰è£…æ ¸å¿ƒä¾èµ–

   ```bash
   pip install -r requirements.txt
   ```

3. å®‰è£…æ¨¡æ€ç‰¹å®šä¾èµ–ï¼ˆå¯é€‰ï¼‰

   ```bash
   # æ–‡æœ¬æ°´å°
   pip install -r src/text_watermark/credid/watermarking/MPAC/requirements.txt
   
   # å›¾åƒæ°´å°ï¼ˆPRCåç«¯ï¼‰
   pip install -r src/image_watermark/PRC-Watermark/requirements.txt
   
   # éŸ³é¢‘æ°´å°
   pip install torch torchaudio julius soundfile librosa scipy matplotlib
   
   # é«˜çº§éŸ³é¢‘åŠŸèƒ½ï¼ˆBark TTSï¼‰
   pip install git+https://github.com/suno-ai/bark.git
   ```

4. é…ç½®ç¯å¢ƒï¼ˆç¦»çº¿æ¨¡å¼å¯é€‰ï¼‰

   ```bash
   export TRANSFORMERS_OFFLINE=1
   export HF_HUB_OFFLINE=1
   export HF_ENDPOINT=https://hf-mirror.com  # ä¸­å›½ç”¨æˆ·
   ```

<p align="right">(<a href="#readme-top">è¿”å›é¡¶éƒ¨</a>)</p>

## ä½¿ç”¨æ–¹æ³•

### å¿«é€Ÿå¼€å§‹

#### æ°´å°

```python
from src.unified.watermark_tool import WatermarkTool

# åˆå§‹åŒ–å·¥å…·
tool = WatermarkTool()

# æ–‡æœ¬æ°´å°
watermarked_text = tool.embed("Please introduce AI generated content", "my_message", 'text')
result = tool.extract(watermarked_text, 'text')

# å›¾åƒæ°´å°
img = tool.embed("A cat under the sun", "img_watermark", 'image')

# éŸ³é¢‘æ°´å°
audio = tool.embed("Hello world", "audio_watermark", 'audio',
                   output_path="output.wav")

# è§†é¢‘æ°´å°
video = tool.embed("The sun shines on the sea", "video_watermark", 'video')
```

#### æ˜¾å¼æ ‡è¯†

```python
from src.utils.visible_mark import (
    add_text_mark_to_text,
    add_overlay_to_image,
    add_overlay_to_video_ffmpeg,
    add_voice_mark_to_audio
)
from PIL import Image

# æ–‡æœ¬æ˜¾å¼æ ‡è¯†
original_text = "è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹æ–‡æœ¬å†…å®¹ã€‚"
marked_text = add_text_mark_to_text(
    original_text,
    mark="æœ¬å†…å®¹ç”±äººå·¥æ™ºèƒ½ç”Ÿæˆ",
    position="start"
)

# å›¾åƒæ˜¾å¼æ ‡è¯†
img = Image.open("input.jpg")
marked_img = add_overlay_to_image(
    img,
    "æœ¬å†…å®¹ç”±äººå·¥æ™ºèƒ½ç”Ÿæˆ",
    position="bottom_right",
    font_percent=4.0,
    font_color="#FFFF00"
)

# è§†é¢‘æ˜¾å¼æ ‡è¯†
marked_video_path = add_overlay_to_video_ffmpeg(
    "input.mp4",
    "output.mp4",
    "æœ¬å†…å®¹ç”±äººå·¥æ™ºèƒ½ç”Ÿæˆ",
    position="bottom_right",
    font_percent=3.0,
    duration_seconds=3.0
)

# éŸ³é¢‘æ˜¾å¼æ ‡è¯†ï¼ˆè¯­éŸ³æ ‡æ³¨ï¼‰
marked_audio_path = add_voice_mark_to_audio(
    "input.wav",
    "output.wav",
    "æœ¬å†…å®¹ç”±äººå·¥æ™ºèƒ½ç”Ÿæˆ",
    position="start",
    voice_preset="v2/zh_speaker_6"
)
```

### è¿è¡Œç½‘é¡µç•Œé¢

```bash
# å¯åŠ¨FlaskæœåŠ¡å™¨
python app.py

# æ‰“å¼€æµè§ˆå™¨å¹¶è®¿é—®
# http://localhost:5000
```

### é«˜çº§é…ç½®

ç¼–è¾‘`config/`ç›®å½•ä¸­çš„é…ç½®æ–‡ä»¶ï¼š

- `config/default_config.yaml`ï¼šæ‰€æœ‰æ¨¡æ€çš„å…¨å±€è®¾ç½®
- `config/text_config.yaml`ï¼šæ–‡æœ¬æ°´å°ç‰¹å®šè®¾ç½®

#### é…ç½®ç¤ºä¾‹

```yaml
# æ–‡æœ¬æ°´å°é…ç½®
text_watermark:
  algorithm: "credid"                    # CredIDç®—æ³•ç”¨äºLLMæ–‡æœ¬æ°´å°
  mode: "lm"                             # LMæ¨¡å¼ï¼ˆè¯­è¨€æ¨¡å‹ï¼Œæ›´é«˜è´¨é‡ï¼‰
  credid:
    watermark_key: "default_key"          # æ°´å°å¯†é’¥æ ‡è¯†ç¬¦
    lm_params:
      delta: 1.5                         # é€»è¾‘ä¿®æ”¹å¼ºåº¦ï¼ˆæ°´å°å¼ºåº¦ï¼‰
      prefix_len: 10                     # ä¸Šä¸‹æ–‡åˆ†æçš„å‰ç¼€é•¿åº¦
      message_len: 10                    # æ°´å°æ¶ˆæ¯é•¿åº¦ï¼ˆä½ï¼‰
    wm_params:
      encode_ratio: 8                    # ç¼–ç æ¯”ç‡ï¼ˆæ¯ä¸ªæ°´å°ä½çš„ä»¤ç‰Œæ•°ï¼‰

# å›¾åƒæ°´å°é…ç½®
image_watermark:
  algorithm: "videoseal"                 # VideoSealç®—æ³•ï¼ˆé»˜è®¤ï¼‰
  resolution: 512                       # AIç”Ÿæˆæ¨¡å¼çš„å›¾åƒåˆ†è¾¨ç‡
  num_inference_steps: 30                # æ¨ç†æ­¥éª¤ï¼ˆè¶Šé«˜è´¨é‡è¶Šå¥½ï¼‰
  guidance_scale: 7.5                    # å¼•å¯¼æ¯”ä¾‹ï¼ˆè¶Šé«˜è¶Šç¬¦åˆæç¤ºï¼‰
  videoseal:
    replicate: 32                        # å¤šå¸§å¤åˆ¶ä»¥å¢å¼ºæ£€æµ‹
    chunk_size: 16                       # å¤„ç†å—å¤§å°ç”¨äºæ•ˆç‡

# éŸ³é¢‘æ°´å°é…ç½®
audio_watermark:
  algorithm: "audioseal"                 # AudioSealéŸ³é¢‘æ°´å°ç®—æ³•
  sample_rate: 16000                     # AudioSealæ‰€éœ€é‡‡æ ·ç‡ï¼ˆ16kHzï¼‰
  message_bits: 16                       # æ°´å°æ¶ˆæ¯é•¿åº¦ï¼ˆä½ï¼‰
  audioseal:
    nbits: 16                           # æ¶ˆæ¯ç¼–ç ä½ï¼ˆåŸºäºSHA256ï¼‰
    alpha: 1.0                          # æ°´å°å¼ºåº¦è°ƒæ•´

# è§†é¢‘æ°´å°é…ç½®
video_watermark:
  watermark: "videoseal"                 # VideoSealæ°´å°ç®—æ³•
  videoseal:
    lowres_attenuation: true             # å¯ç”¨ä½åˆ†è¾¨ç‡ä¼˜åŒ–
    chunk_size: 16                       # å¤§è§†é¢‘çš„å¤„ç†å—å¤§å°
```

<p align="right">(<a href="#readme-top">è¿”å›é¡¶éƒ¨</a>)</p>

## ç½‘é¡µæ¼”ç¤º

![ç½‘é¡µç•Œé¢](pictures/web.png)

å·¥å…·åŒ…åŒ…å«ä¸€ä¸ªç»¼åˆçš„ç½‘é¡µç•Œé¢ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š

### ğŸ¨ ç•Œé¢ç‰¹è‰²

- **åŒæ å¸ƒå±€**ï¼šå·¦ä¾§æ“ä½œé¢æ¿ï¼Œå³ä¾§ç»“æœæ˜¾ç¤º
- **æ¨¡å¼åˆ‡æ¢**ï¼šåœ¨"AIç”Ÿæˆ"å’Œ"ä¸Šä¼ æ–‡ä»¶"æ¨¡å¼ä¹‹é—´åˆ‡æ¢
- **è¯†åˆ«æ–¹æ³•é€‰æ‹©**ï¼šåœ¨"æ°´å°"å’Œ"æ˜¾å¼æ ‡è¯†"ä¹‹é—´é€‰æ‹©
- **å®æ—¶å¯¹æ¯”**ï¼šåŸå§‹å†…å®¹ä¸å¤„ç†åå†…å®¹çš„å¹¶æ’æ˜¾ç¤º
- **å¤šæ ¼å¼æ”¯æŒ**ï¼šå¤„ç†æ‰€æœ‰ä¸»è¦å›¾åƒã€éŸ³é¢‘å’Œè§†é¢‘æ ¼å¼

### ğŸš€ æ”¯æŒçš„æ“ä½œ

| æ¨¡æ€     | æ°´å°   | æ˜¾å¼æ ‡è¯†   | æ–‡ä»¶ä¸Šä¼ æ”¯æŒ |
| -------- | ------------ | ---------- | ------------ |
| **æ–‡æœ¬** | âœ… CredID     | âœ… æ–‡æœ¬æ ‡æ³¨ | âŒ (ä»…ç”Ÿæˆ)   |
| **å›¾åƒ** | âœ… VideoSeal  | âœ… å åŠ æ ‡è®° | âœ… å¤šæ ¼å¼     |
| **éŸ³é¢‘** | âœ… AudioSeal  | âœ… è¯­éŸ³æ ‡æ³¨ | âœ… å¤šæ ¼å¼     |
| **è§†é¢‘** | âœ…  VideoSeal | âœ… å åŠ æ ‡è®° | âœ… è‡ªåŠ¨è½¬ç    |

<p align="right">(<a href="#readme-top">è¿”å›é¡¶éƒ¨</a>)</p>

## APIå‚è€ƒ

### æ ¸å¿ƒAPI

#### æ°´å°API

```python
# åµŒå…¥æ°´å°
result = tool.embed(
    prompt="å†…å®¹æˆ–æç¤º",                    # æ–‡æœ¬å†…å®¹æˆ–ç”Ÿæˆæç¤º
    message="watermark_message",          # è¦åµŒå…¥çš„æ°´å°
    modality="text|image|audio|video",    # å†…å®¹ç±»å‹
    **kwargs                              # æ¨¡æ€ç‰¹å®šå‚æ•°
)

# æå–æ°´å°
detection = tool.extract(
    content,                              # å¸¦æ°´å°çš„å†…å®¹
    modality="text|image|audio|video",    # å†…å®¹ç±»å‹
    **kwargs                              # æ£€æµ‹å‚æ•°
)
```

#### æ˜¾å¼æ ‡è¯†API

```python
from src.utils.visible_mark import *

# ä¸ºä¸åŒæ¨¡æ€æ·»åŠ æ˜¾å¼æ ‡è¯†
marked_text = add_text_mark_to_text(text, mark, position)
marked_image = add_overlay_to_image(image, text, position, font_percent)
marked_video_path = add_overlay_to_video_ffmpeg(input_path, output_path, text)
marked_audio_path = add_voice_mark_to_audio(input_path, output_path, mark_text)
```

### REST APIç«¯ç‚¹

```bash
# æ°´å°åµŒå…¥
POST /api/watermark/<modality>

# æ˜¾å¼æ ‡è¯†
POST /api/visible_mark

# ä»»åŠ¡çŠ¶æ€æ£€æŸ¥
GET /api/status/<task_id>

# æ–‡ä»¶æœåŠ¡
GET /api/files/<task_id>/original
GET /api/files/<task_id>/watermarked
```

<p align="right">(<a href="#readme-top">è¿”å›é¡¶éƒ¨</a>)</p>

## å‘å±•è·¯çº¿

- [x] **æ°´å°å®ç°**
  - [x] CredIDæ–‡æœ¬æ°´å°
  - [x] VideoSealå›¾åƒ/è§†é¢‘æ°´å°
  - [x] AudioSealéŸ³é¢‘æ°´å°
  - [x] PRC-Watermarkæ›¿ä»£åç«¯

- [x] **æ˜¾å¼æ ‡è¯†å®ç°**
  - [x] æ–‡æœ¬å†…å®¹æ ‡æ³¨
  - [x] å›¾åƒå åŠ æ ‡è®°
  - [x] è§†é¢‘å åŠ æ ‡è®°ï¼ˆFFmpegï¼‰
  - [x] éŸ³é¢‘è¯­éŸ³æ ‡æ³¨ï¼ˆBark TTSï¼‰

- [x] **ç½‘é¡µç•Œé¢**
  - [x] åŒæ¨¡å¼æ”¯æŒï¼ˆAIç”Ÿæˆ+æ–‡ä»¶ä¸Šä¼ ï¼‰
  - [x] è¯†åˆ«æ–¹æ³•é€‰æ‹©ï¼ˆä¸å¯è§/å¯è§ï¼‰
  - [x] å®æ—¶å¯¹æ¯”æ˜¾ç¤º
  - [x] å“åº”å¼è®¾è®¡
  - [x] æµè§ˆå™¨å…¼å®¹çš„åª’ä½“è½¬ç 

- [x] **åˆè§„ä¸æ ‡å‡†**
  - [x] GB 45438-2025åˆè§„
  - [x] æ ‡å‡†æ ‡è®°æ–‡æœ¬æ¨¡æ¿
  - [x] å¯é…ç½®çš„å®šä½å’Œæ ·å¼
  - [x] å¤šæ¨¡æ€ç»Ÿä¸€æ–¹æ³•

- [ ] **æœªæ¥å¢å¼º**
  - [ ] å…¶ä»–æ°´å°ç®—æ³•
  - [ ] ç§»åŠ¨åº”ç”¨ç•Œé¢
  - [ ] äº‘éƒ¨ç½²é€‰é¡¹
  - [ ] é«˜çº§åˆ†æä»ªè¡¨æ¿
  - [ ] ç•Œé¢å¤šè¯­è¨€æ”¯æŒ

æŸ¥çœ‹[å¼€æ”¾é—®é¢˜](https://github.com/your-repo-link/issues)è·å–å®Œæ•´çš„åŠŸèƒ½æè®®å’Œå·²çŸ¥é—®é¢˜åˆ—è¡¨ã€‚

<p align="right">(<a href="#readme-top">è¿”å›é¡¶éƒ¨</a>)</p>

## è‡´è°¢

* [Meta AudioSeal](https://github.com/facebookresearch/audioseal) - éŸ³é¢‘æ°´å°ç®—æ³•
* [VideoSeal](https://github.com/facebookresearch/videoseal) - è§†é¢‘æ°´å°æŠ€æœ¯
* [Bark TTS](https://github.com/suno-ai/bark) - æ–‡æœ¬è½¬è¯­éŸ³åˆæˆ
* [HunyuanVideo](https://huggingface.co/hunyuanvideo-community/HunyuanVideo) - æ–‡æœ¬è½¬è§†é¢‘ç”Ÿæˆ
* [Hugging Face](https://huggingface.co) - æ¨¡å‹æ‰˜ç®¡å’Œtransformersåº“
* [PyTorch](https://pytorch.org) - æ·±åº¦å­¦ä¹ æ¡†æ¶

<p align="right">(<a href="#readme-top">è¿”å›é¡¶éƒ¨</a>)</p>

<!-- MARKDOWNé“¾æ¥å’Œå›¾åƒ -->

[Python.org]: https://img.shields.io/badge/Python-3776AB?style=for-the-badge&logo=python&logoColor=white
[Python-url]: https://python.org/
[PyTorch.org]: https://img.shields.io/badge/PyTorch-EE4C2C?style=for-the-badge&logo=pytorch&logoColor=white
[PyTorch-url]: https://pytorch.org/
[Flask.palletsprojects.com]: https://img.shields.io/badge/Flask-000000?style=for-the-badge&logo=flask&logoColor=white
[Flask-url]: https://flask.palletsprojects.com/
[Transformers-badge]: https://img.shields.io/badge/ğŸ¤—%20Transformers-FFD700?style=for-the-badge
[Transformers-url]: https://huggingface.co/transformers/
[Diffusers-badge]: https://img.shields.io/badge/ğŸ§¨%20Diffusers-FF6B6B?style=for-the-badge
[Diffusers-url]: https://huggingface.co/docs/diffusers/