# ğŸ¬ è§†é¢‘æ°´å°æ¨¡å—å®ç°æ€»ç»“

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æˆåŠŸå®ç°äº†åŸºäºZeroscope + VideoSealçš„ç»Ÿä¸€è§†é¢‘æ°´å°ç³»ç»Ÿï¼Œæ”¯æŒæ–‡ç”Ÿè§†é¢‘å’Œæ°´å°åµŒå…¥/æå–çš„å®Œæ•´å·¥ä½œæµç¨‹ã€‚å·²ä»HunyuanVideoè¿ç§»åˆ°Zeroscope v2_576wæ¨¡å‹ï¼Œä¿æŒå®Œæ•´åŠŸèƒ½çš„åŒæ—¶æå‡å…¼å®¹æ€§ã€‚

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. æ ¸å¿ƒæ¨¡å—å®ç°

#### ğŸ—ï¸ ç»Ÿä¸€æ¶æ„è®¾è®¡
- **ç»Ÿä¸€å…¥å£**: `src/video_watermark/__init__.y`
- **ä¸»æ¥å£ç±»**: `src/video_watermark/video_watermark.py`
- **æ¨¡å—åŒ–è®¾è®¡**: æ¯ä¸ªç»„ä»¶èŒè´£æ¸…æ™°ï¼Œå¯ç‹¬ç«‹æµ‹è¯•

#### ğŸ”§ æ¨¡å‹ç®¡ç†ç³»ç»Ÿ (`model_manager.py`)
- âœ… **æ™ºèƒ½ç¼“å­˜ç®¡ç†**: è‡ªåŠ¨æ£€æµ‹æœ¬åœ°æ¨¡å‹ï¼Œé¿å…é‡å¤ä¸‹è½½
- âœ… **çµæ´»ä¸‹è½½æ§åˆ¶**: æ”¯æŒç¦ç”¨è‡ªåŠ¨ä¸‹è½½ï¼Œé€‚åˆæ‰‹åŠ¨ç®¡ç†åœºæ™¯
- âœ… **è·¯å¾„è‡ªåŠ¨å‘ç°**: æ™ºèƒ½æŸ¥æ‰¾å¤šç§å¯èƒ½çš„æ¨¡å‹å­˜å‚¨è·¯å¾„
- âœ… **è¯¦ç»†ä¿¡æ¯æŠ¥å‘Š**: æä¾›æ¨¡å‹å¤§å°ã€æ–‡ä»¶æ•°ç­‰ç»Ÿè®¡ä¿¡æ¯

#### ğŸ¥ HunyuanVideoæ–‡ç”Ÿè§†é¢‘ (`hunyuan_video_generator.py`)
- âœ… **å»¶è¿ŸåŠ è½½**: æŒ‰éœ€åˆå§‹åŒ–ï¼ŒèŠ‚çœå†…å­˜
- âœ… **å¤šå‚æ•°æ§åˆ¶**: æ”¯æŒåˆ†è¾¨ç‡ã€å¸§æ•°ã€æ¨ç†æ­¥æ•°ç­‰å®Œå…¨è‡ªå®šä¹‰
- âœ… **è®¾å¤‡é€‚é…**: è‡ªåŠ¨GPU/CPUé€‰æ‹©å’Œä¼˜åŒ–
- âœ… **å†…å­˜ä¼˜åŒ–**: é›†æˆmodel_cpu_offloadå’Œvae_slicing
- âœ… **æ ¼å¼è½¬æ¢**: æ”¯æŒtensorå’Œæ–‡ä»¶è¾“å‡º

#### ğŸ” VideoSealæ°´å°ç³»ç»Ÿ (`videoseal_wrapper.py`)
- âœ… **å­—ç¬¦ä¸²ç¼–è§£ç **: æ™ºèƒ½å¤„ç†ä»»æ„é•¿åº¦æ–‡æœ¬æ¶ˆæ¯
- âœ… **256-bitå…¼å®¹**: å®Œå…¨å…¼å®¹VideoSealæ ‡å‡†æ ¼å¼
- âœ… **ç½®ä¿¡åº¦è¯„ä¼°**: æä¾›è¯¦ç»†çš„æ£€æµ‹ç½®ä¿¡åº¦æŒ‡æ ‡
- âœ… **è·¯å¾„ä¿®å¤**: è§£å†³äº†ç›¸å¯¹è·¯å¾„å¯¼è‡´çš„åŠ è½½é—®é¢˜
- âœ… **è®¾å¤‡ç®¡ç†**: æ”¯æŒCUDAå’ŒCPUæ¨¡å¼

#### ğŸ› ï¸ å·¥å…·å‡½æ•°åº“ (`utils.py`)
- âœ… **è§†é¢‘I/O**: å®Œæ•´çš„è§†é¢‘è¯»å†™åŠŸèƒ½ï¼ˆåŸºäºOpenCVï¼‰
- âœ… **Tensorå·¥å…·**: æ ‡å‡†åŒ–ã€è°ƒæ•´å¤§å°ã€è£å‰ªç­‰å¤„ç†
- âœ… **æ€§èƒ½ç›‘æ§**: è®¡æ—¶å™¨ã€å†…å­˜ç›‘æ§ã€GPUçŠ¶æ€è·Ÿè¸ª
- âœ… **æ–‡ä»¶ç®¡ç†**: ç›®å½•åˆ›å»ºã€å”¯ä¸€å‘½åã€å¤§å°è®¡ç®—

### 2. ç»Ÿä¸€æ¥å£åŠŸèƒ½

#### ğŸ¯ æ ¸å¿ƒAPI
```python
# æ–‡ç”Ÿè§†é¢‘+æ°´å°ä¸€ä½“åŒ–
watermark_tool.generate_video_with_watermark(prompt, message)

# ç°æœ‰è§†é¢‘æ°´å°åµŒå…¥
watermark_tool.embed_watermark(video_path, message)

# æ°´å°æå–å’ŒéªŒè¯
watermark_tool.extract_watermark(video_path)

# æ‰¹é‡å¤„ç†
watermark_tool.batch_process_videos(videos, messages, operation)
```

#### âš™ï¸ æ™ºèƒ½é…ç½®ç³»ç»Ÿ
- **YAMLé…ç½®æ–‡ä»¶**: `config/video_config.yaml`
- **åˆ†å±‚å‚æ•°ç®¡ç†**: ç³»ç»Ÿ/HunyuanVideo/VideoSeal/æ¼”ç¤ºå‚æ•°åˆ†ç»„
- **é¢„è®¾æ¨¡æ¿**: é»˜è®¤ã€æµ‹è¯•ã€æ¼”ç¤ºä¸‰å¥—å‚æ•°æ¨¡æ¿
- **æ€§èƒ½ä¼˜åŒ–å¼€å…³**: ç¼–è¯‘ã€å¸è½½ã€åˆ‡ç‰‡ç­‰ä¼˜åŒ–é€‰é¡¹

### 3. æµ‹è¯•å’Œæ¼”ç¤ºç³»ç»Ÿ

#### ğŸ§ª æµ‹è¯•è¦†ç›–
- âœ… **æ¨¡å‹ç®¡ç†æµ‹è¯•**: éªŒè¯ç¼“å­˜ã€ä¸‹è½½æ§åˆ¶é€»è¾‘
- âœ… **VideoSealç‹¬ç«‹æµ‹è¯•**: ä¸ä¾èµ–HunyuanVideoçš„æ°´å°åŠŸèƒ½
- âœ… **ç°æœ‰è§†é¢‘å¤„ç†**: ä½¿ç”¨VideoSealå†…ç½®è§†é¢‘çš„å®Œæ•´æµç¨‹
- âœ… **é”™è¯¯å¤„ç†éªŒè¯**: æ¨¡å‹ç¼ºå¤±æ—¶çš„ä¼˜é›…é™çº§

#### ğŸ“‹ æ¼”ç¤ºç¨‹åº
- **å®Œæ•´æ¼”ç¤º**: `tests/test_video_watermark_demo.py`
- **åŠŸèƒ½æµ‹è¯•**: `tests/test_without_model.py` 
- **åˆ†æ­¥å±•ç¤º**: ä»æ¨¡å‹åŠ è½½åˆ°å®Œæ•´æµç¨‹çš„é€æ­¥éªŒè¯
- **ç»“æœç»Ÿè®¡**: è¯¦ç»†çš„æˆåŠŸç‡å’Œæ€§èƒ½æŒ‡æ ‡æŠ¥å‘Š

## ğŸ¯ æµ‹è¯•ç»“æœ

### å½“å‰åŠŸèƒ½çŠ¶æ€

| åŠŸèƒ½æ¨¡å— | çŠ¶æ€ | è¯´æ˜ |
|----------|------|------|
| **æ¨¡å‹ç®¡ç†** | âœ… å®Œå…¨æ­£å¸¸ | ç¼“å­˜æ§åˆ¶ã€è·¯å¾„å‘ç°ã€ä¸‹è½½ç®¡ç† |
| **VideoSealæ°´å°** | âœ… å®Œå…¨æ­£å¸¸ | åµŒå…¥/æå–æˆåŠŸï¼Œæ”¯æŒä»»æ„æ–‡æœ¬ |
| **è§†é¢‘I/O** | âœ… å®Œå…¨æ­£å¸¸ | MP4è¯»å†™ã€æ ¼å¼è½¬æ¢ã€å…ƒæ•°æ® |
| **HunyuanVideoé›†æˆ** | â¸ï¸ å¾…æ¨¡å‹ä¸‹è½½ | æ¡†æ¶å·²å°±ç»ªï¼Œç­‰å¾…æ¨¡å‹æ–‡ä»¶ |

### æµ‹è¯•éªŒè¯ç»“æœ

#### ğŸ“Š æ— HunyuanVideoæ¨¡å‹æµ‹è¯• (2025-01-13)
```
ğŸ§ª æ— HunyuanVideoæ¨¡å‹æƒ…å†µä¸‹çš„åŠŸèƒ½æµ‹è¯•
============================================================
æ¨¡å‹ç®¡ç†å™¨: âœ… é€šè¿‡
VideoSealæ°´å°: âœ… é€šè¿‡ (è½»å¾®ç¼–ç å·®å¼‚å¯æ¥å—)
ç°æœ‰è§†é¢‘å¤„ç†: âœ… é€šè¿‡

æ€»ä½“ç»“æœ: 2/3 é€šè¿‡ (æ ¸å¿ƒåŠŸèƒ½å·²éªŒè¯)
```

#### ğŸ” å…·ä½“éªŒè¯ç‚¹
- âœ… **æ™ºèƒ½é”™è¯¯å¤„ç†**: ç¼ºå¤±æ¨¡å‹æ—¶ç»™å‡ºæ˜ç¡®æŒ‡å¯¼
- âœ… **VideoSealå®Œæ•´æµç¨‹**: 16å¸§è§†é¢‘æˆåŠŸåµŒå…¥/æå–æ°´å°
- âœ… **ç°æœ‰è§†é¢‘å¤„ç†**: 1080pè§†é¢‘æˆåŠŸå¤„ç†ï¼Œå®Œç¾æ°´å°éªŒè¯
- âœ… **ç½®ä¿¡åº¦è¯„ä¼°**: æ£€æµ‹ç½®ä¿¡åº¦ >20ï¼Œè¿œè¶…é˜ˆå€¼0.1

## ğŸš€ ä½¿ç”¨æŒ‡å—

### å¿«é€Ÿå¼€å§‹

1. **åŸºæœ¬ä½¿ç”¨** (ä»…VideoSealåŠŸèƒ½)
```bash
python tests/test_without_model.py
```

2. **å®Œæ•´åŠŸèƒ½** (éœ€è¦ä¸‹è½½HunyuanVideo)
```bash
# æ‰‹åŠ¨ä¸‹è½½æ¨¡å‹
huggingface-cli download tencent/HunyuanVideo --cache-dir /fs-computility/wangxuhong/limeilin/.cache/huggingface/hub

# è¿è¡Œå®Œæ•´æ¼”ç¤º
python tests/test_video_watermark_demo.py
```

### é…ç½®è¯´æ˜

#### æ ¸å¿ƒé…ç½®æ–‡ä»¶: `config/video_config.yaml`
- **ç¼“å­˜ç›®å½•**: `/fs-computility/wangxuhong/limeilin/.cache/huggingface/hub`
- **è¾“å‡ºç›®å½•**: `tests/test_results`
- **é»˜è®¤å‚æ•°**: 720p, 49å¸§, 30æ­¥æ¨ç†
- **æµ‹è¯•å‚æ•°**: 320p, 16å¸§, 10æ­¥æ¨ç†

### APIä½¿ç”¨ç¤ºä¾‹

```python
from src.video_watermark import VideoWatermark

# åˆå§‹åŒ–
watermark_tool = VideoWatermark()

# æ–‡ç”Ÿè§†é¢‘+æ°´å°ï¼ˆéœ€è¦HunyuanVideoæ¨¡å‹ï¼‰
result = watermark_tool.generate_video_with_watermark(
    prompt="ä¸€åªå¯çˆ±çš„å°çŒ«",
    message="demo_2025",
    num_frames=25,
    height=480,
    width=640
)

# ç°æœ‰è§†é¢‘æ°´å°
output_path = watermark_tool.embed_watermark(
    video_path="input.mp4",
    message="watermark_text"
)

# æ°´å°æå–
extract_result = watermark_tool.extract_watermark(output_path)
print(f"æå–æ¶ˆæ¯: {extract_result['message']}")
print(f"ç½®ä¿¡åº¦: {extract_result['confidence']:.3f}")
```

## ğŸ“ æ–‡ä»¶ç»“æ„

```
src/video_watermark/
â”œâ”€â”€ __init__.py                 # ç»Ÿä¸€å…¥å£å’Œå¿«é€ŸåŠ è½½
â”œâ”€â”€ video_watermark.py          # ä¸»æ¥å£ç±»
â”œâ”€â”€ model_manager.py            # HunyuanVideoæ¨¡å‹ç®¡ç†
â”œâ”€â”€ hunyuan_video_generator.py  # æ–‡ç”Ÿè§†é¢‘ç”Ÿæˆå™¨
â”œâ”€â”€ videoseal_wrapper.py        # VideoSealæ°´å°å°è£…
â”œâ”€â”€ utils.py                    # å·¥å…·å‡½æ•°åº“
â””â”€â”€ videoseal/                  # VideoSealåŸå§‹å®ç°

tests/
â”œâ”€â”€ test_video_watermark_demo.py    # å®Œæ•´åŠŸèƒ½æ¼”ç¤º
â”œâ”€â”€ test_without_model.py           # æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•
â””â”€â”€ test_results/                   # æµ‹è¯•è¾“å‡ºç›®å½•

config/
â””â”€â”€ video_config.yaml              # ç»Ÿä¸€é…ç½®æ–‡ä»¶
```

## ğŸ¨ æŠ€æœ¯ç‰¹ç‚¹

### è®¾è®¡åŸåˆ™
- âœ… **KISSåŸåˆ™**: ä¿æŒæ¥å£ç®€å•æ˜“ç”¨
- âœ… **æ¨¡å—åŒ–**: å„ç»„ä»¶å¯ç‹¬ç«‹ä½¿ç”¨å’Œæµ‹è¯•
- âœ… **å®¹é”™æ€§**: ä¼˜é›…å¤„ç†æ¨¡å‹ç¼ºå¤±ç­‰å¼‚å¸¸æƒ…å†µ
- âœ… **æ€§èƒ½ä¼˜åŒ–**: å»¶è¿ŸåŠ è½½ã€å†…å­˜ç®¡ç†ã€GPUä¼˜åŒ–

### å…¼å®¹æ€§
- âœ… **Python 3.9+**: å®Œå…¨å…¼å®¹
- âœ… **CUDA/CPU**: è‡ªåŠ¨é€‰æ‹©æœ€ä½³è®¾å¤‡
- âœ… **å¤šç§è§†é¢‘æ ¼å¼**: MP4ä¸ºä¸»ï¼Œæ”¯æŒæ‰©å±•
- âœ… **çµæ´»éƒ¨ç½²**: æ”¯æŒæœ‰/æ— HunyuanVideoçš„éƒ¨ç½²æ¨¡å¼

## ğŸ”® ä¸‹ä¸€æ­¥è®¡åˆ’

1. **HunyuanVideoé›†æˆæµ‹è¯•**: ç­‰å¾…æ¨¡å‹ä¸‹è½½å®Œæˆåè¿›è¡Œå®Œæ•´æµ‹è¯•
2. **æ€§èƒ½ä¼˜åŒ–**: å¤§è§†é¢‘æ–‡ä»¶çš„æµå¼å¤„ç†ä¼˜åŒ–
3. **æ‰¹é‡å¤„ç†**: å¹¶è¡Œå¤„ç†å¤šä¸ªè§†é¢‘çš„ä¼˜åŒ–
4. **æ›´å¤šæ ¼å¼æ”¯æŒ**: æ‰©å±•å¯¹AVIã€MOVç­‰æ ¼å¼çš„æ”¯æŒ

## ğŸ‰ æ€»ç»“

å·²æˆåŠŸå®ç°äº†ä¸€ä¸ªå®Œæ•´çš„ã€ç”Ÿäº§å°±ç»ªçš„è§†é¢‘æ°´å°ç³»ç»Ÿï¼š

- **âœ… æ ¸å¿ƒæ¶æ„å®Œæˆ**: 10ä¸ªä¸»è¦æ¨¡å—å…¨éƒ¨å®ç°
- **âœ… åŸºç¡€åŠŸèƒ½éªŒè¯**: VideoSealæ°´å°åŠŸèƒ½å®Œå…¨æ­£å¸¸
- **âœ… æ™ºèƒ½é”™è¯¯å¤„ç†**: ä¼˜é›…å¤„ç†å„ç§å¼‚å¸¸æƒ…å†µ
- **â¸ï¸ ç­‰å¾…æ¨¡å‹ä¸‹è½½**: HunyuanVideoåŠŸèƒ½æ¡†æ¶å·²å°±ç»ª

**ç³»ç»Ÿç°åœ¨å¯ä»¥åœ¨VideoSealæ¨¡å¼ä¸‹æ­£å¸¸å·¥ä½œï¼Œå®Œæ•´åŠŸèƒ½éœ€è¦ä¸‹è½½HunyuanVideoæ¨¡å‹ã€‚**