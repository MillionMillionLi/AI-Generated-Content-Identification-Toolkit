# PRCå›¾åƒæ°´å°å°è£…å®ç°è®¡åˆ’

## ğŸ¯ é¡¹ç›®ç›®æ ‡
ä¸ºç»Ÿä¸€å¤šæ¨¡æ€æ°´å°å·¥å…·å®ç°PRCå›¾åƒæ°´å°å°è£…ï¼Œæä¾›ç®€æ´æ˜“ç”¨çš„`embed`å’Œ`extract`æ¥å£ã€‚

## ğŸ“‹ æ ¸å¿ƒä»»åŠ¡æ¸…å•

### é˜¶æ®µä¸€ï¼šPRCæ°´å°æ ¸å¿ƒå°è£… ğŸ”¥ **é«˜ä¼˜å…ˆçº§**

#### âœ… ä»»åŠ¡1ï¼šåˆ›å»ºPRCæ°´å°æ ¸å¿ƒå°è£…ç±»
**æ–‡ä»¶ï¼š** `src/image_watermark/prc_watermark.py`

**åŠŸèƒ½è¦æ±‚ï¼š**
- [ ] å®ç°`PRCWatermark`ç±»çš„åŸºç¡€æ¶æ„
- [ ] å®ç°`__init__(config)`åˆå§‹åŒ–æ–¹æ³•
- [ ] å®ç°`embed(prompt, message=None, **kwargs)`æ–¹æ³•
  - [ ] æ”¯æŒé›¶ä½æ£€æµ‹æ¨¡å¼ï¼ˆ`message=None`ï¼‰
  - [ ] æ”¯æŒé•¿æ¶ˆæ¯åµŒå…¥æ¨¡å¼ï¼ˆå­—ç¬¦ä¸²/äºŒè¿›åˆ¶åˆ—è¡¨ï¼‰
  - [ ] è‡ªåŠ¨æ¶ˆæ¯æ ¼å¼è½¬æ¢ï¼ˆå­—ç¬¦ä¸²â†’äºŒè¿›åˆ¶ï¼‰
  - [ ] é›†æˆPRCå¯†é’¥ç”Ÿæˆå’Œç®¡ç†
  - [ ] é›†æˆStable Diffusionå›¾åƒç”Ÿæˆ
- [ ] å®ç°`extract(image)`æ–¹æ³•
  - [ ] å›¾åƒé€†å‘åˆ°æ½œåœ¨ç©ºé—´ï¼ˆexact_inversionï¼‰
  - [ ] åéªŒæ¦‚ç‡è®¡ç®—ï¼ˆrecover_posteriorsï¼‰
  - [ ] æ°´å°æ£€æµ‹ï¼ˆDetectå‡½æ•°ï¼‰
  - [ ] è‡ªåŠ¨æ¶ˆæ¯è§£ç ï¼ˆDecodeå‡½æ•°ï¼Œæ£€æµ‹åˆ°æ°´å°æ—¶ï¼‰
  - [ ] ç»Ÿä¸€è¿”å›æ ¼å¼

**æŠ€æœ¯é‡ç‚¹ï¼š**
- [ ] è‡ªåŠ¨å¯†é’¥ç”Ÿæˆå’Œç¼“å­˜æœºåˆ¶
- [ ] å‚æ•°è‡ªé€‚åº”ä¼˜åŒ–ï¼ˆåŸºäºæ¶ˆæ¯é•¿åº¦ï¼‰
- [ ] å®Œå–„çš„é”™è¯¯å¤„ç†å’ŒçŠ¶æ€æŠ¥å‘Š
- [ ] æ€§èƒ½ä¼˜åŒ–ï¼ˆæ¨¡å‹åŠ è½½ã€æ¨ç†åŠ é€Ÿï¼‰

#### âœ… ä»»åŠ¡2ï¼šè¾…åŠ©åŠŸèƒ½å®ç°
**ç›¸å…³åŠŸèƒ½ï¼š**
- [ ] `_load_or_generate_keys()`ï¼šå¯†é’¥ç®¡ç†
- [ ] `_message_to_binary()`ï¼šæ¶ˆæ¯ç¼–ç 
- [ ] `_binary_to_message()`ï¼šæ¶ˆæ¯è§£ç   
- [ ] `_setup_diffusion_model()`ï¼šæ¨¡å‹åˆå§‹åŒ–


### é˜¶æ®µäºŒï¼šç³»ç»Ÿé›†æˆ ğŸ”¶ **ä¸­ä¼˜å…ˆçº§**

#### âœ… ä»»åŠ¡3ï¼šæ›´æ–°ç°æœ‰å›¾åƒæ°´å°åŸºç±»
**æ–‡ä»¶ï¼š** `src/image_watermark/image_watermark.py`

**ä¿®æ”¹å†…å®¹ï¼š**
- [ ] é›†æˆ`PRCWatermark`ç®—æ³•æ”¯æŒ
- [ ] æ›´æ–°`embed_watermark()`æ–¹æ³•å®ç°
- [ ] æ›´æ–°`extract_watermark()`æ–¹æ³•å®ç°
- [ ] æ›´æ–°`generate_with_watermark()`æ–¹æ³•
- [ ] ä¿æŒå‘åå…¼å®¹æ€§

#### âœ… ä»»åŠ¡4ï¼šé…ç½®ç³»ç»Ÿæ›´æ–°
**æ–‡ä»¶ï¼š** `config/default_config.yaml`

**æ–°å¢é…ç½®é¡¹ï¼š**
- [ ] PRCç®—æ³•ä¸“ç”¨é…ç½®æ®µ
- [ ] æ¨¡å‹è·¯å¾„å’Œç¼“å­˜è®¾ç½®
- [ ] æ°´å°å‚æ•°é…ç½®ï¼ˆè¯¯æŠ¥ç‡ã€ç¨€ç–åº¦ç­‰ï¼‰
- [ ] æ€§èƒ½ä¼˜åŒ–å‚æ•°

#### âœ… ä»»åŠ¡5ï¼šç»Ÿä¸€å¼•æ“é›†æˆ
**æ–‡ä»¶ï¼š** `src/unified/watermark_tool.py`

**é›†æˆå†…å®¹ï¼š**
- [ ] æ”¯æŒPRCå›¾åƒæ°´å°ç®—æ³•é€‰æ‹©
- [ ] æ›´æ–°`generate_image_with_watermark()`æ–¹æ³•
- [ ] æ›´æ–°`extract_image_watermark()`æ–¹æ³•
- [ ] ä¿æŒAPIä¸€è‡´æ€§

### é˜¶æ®µä¸‰ï¼šæµ‹è¯•ä¸ä¼˜åŒ– ğŸ”µ **ä¸€èˆ¬ä¼˜å…ˆçº§**

#### âœ… ä»»åŠ¡6ï¼šç¤ºä¾‹å’Œæ¼”ç¤º
**æ–‡ä»¶ï¼š** `examples/image_watermark_demo.py`

**æ¼”ç¤ºå†…å®¹ï¼š**
- [ ] é›¶ä½æ£€æµ‹æ¨¡å¼æ¼”ç¤º
- [ ] é•¿æ¶ˆæ¯åµŒå…¥æ¼”ç¤ºï¼ˆå­—ç¬¦ä¸²ã€äºŒè¿›åˆ¶ï¼‰
- [ ] æ‰¹é‡å¤„ç†ç¤ºä¾‹
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•
- [ ] é²æ£’æ€§æµ‹è¯•ï¼ˆJPEGå‹ç¼©ã€é«˜æ–¯æ¨¡ç³Šç­‰ï¼‰

#### âœ… ä»»åŠ¡7ï¼šå•å…ƒæµ‹è¯•
**æ–‡ä»¶ï¼š** `tests/test_prc_watermark.py`

**æµ‹è¯•ç”¨ä¾‹ï¼š**
- [ ] å¯†é’¥ç”Ÿæˆå’ŒåŠ è½½æµ‹è¯•
- [ ] æ¶ˆæ¯ç¼–ç è§£ç æµ‹è¯•
- [ ] å›¾åƒç”Ÿæˆæµ‹è¯•
- [ ] æ°´å°æ£€æµ‹å‡†ç¡®æ€§æµ‹è¯•
- [ ] æ¶ˆæ¯è§£ç å‡†ç¡®æ€§æµ‹è¯•
- [ ] é”™è¯¯å¤„ç†æµ‹è¯•
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•

#### âœ… ä»»åŠ¡8ï¼šæ–‡æ¡£å’Œä¼˜åŒ–
- [ ] æ›´æ–°`CLAUDE.md`ä¸­çš„PRCæ°´å°ä½¿ç”¨è¯´æ˜
- [ ] æ€§èƒ½åˆ†æå’Œä¼˜åŒ–
- [ ] å†…å­˜ä½¿ç”¨ä¼˜åŒ–
- [ ] GPUåˆ©ç”¨ç‡ä¼˜åŒ–

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### å…³é”®ä¾èµ–åº“
```python
# æ ¸å¿ƒä¾èµ–
torch>=1.10.0
diffusers>=0.10.0
transformers>=4.20.0
Pillow>=9.0.0

# PRCç‰¹å®šä¾èµ–
galois>=0.4.1
ldpc>=0.1.51
scipy>=1.7.0
```

### é…ç½®ç¤ºä¾‹
```yaml
image_watermark:
  algorithm: "prc"
  prc:
    model_name: "stabilityai/stable-diffusion-2-1-base"
    max_message_length: 512
    false_positive_rate: 1e-6
    sparsity: 3
    variance: 1.5
    num_inference_steps: 50
    guidance_scale: 7.5
    resolution: 512
    keys_dir: "./keys"
```

### æ¥å£è®¾è®¡è§„èŒƒ
```python
# åµŒå…¥æ¥å£
result = watermark.embed(
    prompt="A beautiful sunset",
    message="Hello PRC!"  # å¯é€‰ï¼šNoneä¸ºé›¶ä½æ¨¡å¼
)
# è¿”å›ï¼š{'watermarked_image': PIL.Image, 'success': bool, ...}

# æå–æ¥å£  
result = watermark.extract("image.png")
# è¿”å›ï¼š{'detected': bool, 'decoded_message': str, 'confidence': float, ...}
```

## ğŸ“Š é¡¹ç›®é‡Œç¨‹ç¢‘

- **é‡Œç¨‹ç¢‘1** (Week 1)ï¼šå®ŒæˆPRCæ°´å°æ ¸å¿ƒå°è£…ç±»
- **é‡Œç¨‹ç¢‘2** (Week 2)ï¼šå®Œæˆç³»ç»Ÿé›†æˆå’Œé…ç½®æ›´æ–°
- **é‡Œç¨‹ç¢‘3** (Week 3)ï¼šå®Œæˆæµ‹è¯•ã€ç¤ºä¾‹å’Œæ–‡æ¡£

## ğŸš€ æˆåŠŸæ ‡å‡†

1. **åŠŸèƒ½å®Œæ•´æ€§**ï¼šæ”¯æŒé›¶ä½æ£€æµ‹å’Œé•¿æ¶ˆæ¯åµŒå…¥ä¸¤ç§æ¨¡å¼
2. **æ¥å£ä¸€è‡´æ€§**ï¼šä¸ç°æœ‰æ–‡æœ¬æ°´å°æ¥å£é£æ ¼ä¿æŒä¸€è‡´
3. **æ€§èƒ½è¡¨ç°**ï¼šå›¾åƒç”Ÿæˆ<30ç§’ï¼Œæ°´å°æ£€æµ‹<10ç§’
4. **é²æ£’æ€§**ï¼šåœ¨å¸¸è§æ”»å‡»ä¸‹ä¿æŒ>90%çš„æ£€æµ‹ç‡
5. **æ˜“ç”¨æ€§**ï¼šæä¾›æ¸…æ™°çš„æ–‡æ¡£å’Œç¤ºä¾‹

## âš ï¸ é£é™©å’ŒæŒ‘æˆ˜

1. **æ¨¡å‹åŠ è½½æ—¶é—´**ï¼šStable Diffusionæ¨¡å‹è¾ƒå¤§ï¼Œéœ€è¦ä¼˜åŒ–åŠ è½½
2. **å†…å­˜å ç”¨**ï¼šéœ€è¦åˆç†ç®¡ç†GPUå†…å­˜ä½¿ç”¨
3. **å‚æ•°è°ƒä¼˜**ï¼šä¸åŒæ¶ˆæ¯é•¿åº¦éœ€è¦ä¸åŒçš„æœ€ä¼˜å‚æ•°
4. **é”™è¯¯å¤„ç†**ï¼šç½‘ç»œã€æ¨¡å‹ã€è§£ç ç­‰å¤šå±‚æ¬¡é”™è¯¯å¤„ç†

## ğŸ“ å¼€å‘æ³¨æ„äº‹é¡¹

- éµå¾ªç°æœ‰ä»£ç é£æ ¼å’Œå‘½åè§„èŒƒ
- ä¿æŒä¸æ–‡æœ¬æ°´å°æ¥å£çš„ä¸€è‡´æ€§
- é‡è§†é”™è¯¯å¤„ç†å’Œç”¨æˆ·ä½“éªŒ
- æ³¨é‡æ€§èƒ½ä¼˜åŒ–å’Œèµ„æºç®¡ç†
- æä¾›è¯¦ç»†çš„æ—¥å¿—å’Œè°ƒè¯•ä¿¡æ¯